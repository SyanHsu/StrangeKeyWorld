# StrangeKeyworld
一个类似STRANGE KEYWORLD的2D平台跳跃解谜游戏
## 前言
实习要求在一周内开发出该游戏，因之前未接触过此题材的教程，也没有做过相关技术探究，所以过程中吃了不少苦头。开始时浪费了些时间在素材绘制上，中途又因为一些bug困扰了好几天，后来推翻重做并做了一些改进才最终基本实现了游戏功能。但因时间原因所以只做出了简单的基础场景，未能制作足够的关卡，敬请见谅。
## 简介
本游戏为一个用unity制作的类似STRANGE KEYWORLD的简易2D平台跳跃解谜游戏。实现了与原游戏类似的基本的移动和跳跃，实现了蹬墙跳的功能。实现了基本游戏特色，只有在同一屏幕里的按钮才能被按下起反应，且按钮可以从一个场景移动到另一个场景。按下R键可由最初位置重新开始。当玩家看到YOU WIN显示时即游戏结束。
## 实现方法
### 移动和跳跃功能
#### 基本移动和跳跃
对玩家建立了两个脚本PlayerMoveStatus和PlayerController。
其中PlayerMoveStatus为单例模式，记录了玩家移动的状态，即七个关键按键（left、right、up、W、A、D、Space）的可用状态和按下状态。
在PlayerController里实现玩家控制。在FixedUpdate里进行输入检测，当按键可用并按下时判定输入有效，传递给PlayerMoveStatus及相关参量。在Update里进行物理模拟，对人物的四周进行判断以确定玩家是否位于地面或墙壁，结合输入检测来修改动画的参量，给刚体速度来实现移动，添加向上的力实现跳跃。通过玩家朝向选择向左或者向右跳（体现在动画的不同）。动画状态包括闲置、移动、左跳、右跳、左墙上、右墙上。
#### 土狼时间和输入缓冲
土狼时间：设置一个土狼时间计时器，当人物在地面上时重置，其余时开始计时（当有向上的速度时归零防止重复跳跃），在设置的土狼时间内按键，可以进行跳跃。
输入缓冲：设置输入缓冲计时器，在按键后重置，在规定时间内符合其他跳跃条件时就可以执行跳跃动作。
#### 蹬墙跳
当人物位于墙上时向墙的方向移动则下落速度变慢，实现方式为减小了刚体的重力尺度。若此时按下跳跃键则人物会受到一段时间的反向和向上的速度，在这段时间内为“飞行状态”，移动指令将不可用。
### 摄像机设置和移动
为实现原游戏中屏幕效果，设置了一个主摄像机和背景摄像机，主摄像机渲染场景，占据视口长和宽的80%，而背景摄像机不渲染，占据全部视口。
当人物走出摄像机时，主摄像机向人物方向移动固定距离。
### 屏幕中按钮对按键的反应
设定一个ButtonController的基类，其余按钮继承自该基类。设定按下按钮和松开按钮时的方法：当对应按键按下时将其改为按下后的状态，同时使其碰撞器不可用；当松开对应按键时相反。
#### 关键按键的反应
对七个关键按键（left、right、up、W、A、D、Space），当按键对相机可见时即按键可用，并同步至PlayerMoveStatus。同时通过PlayerMoveStatus中相关变量状态来判断对应按键是否被按下。
#### 其余按键的反应
对其余非关键按键，即与人物移动无关的按键，直接通过检测输入来判断对应按键是否被按下。
#### 特定按钮的移动
对特定按钮，当对应按键按下时实现基础功能的同时可向固定方向移动。
## 开发日志
### 2022.3.13
修改了bug，实现了基本功能，移动和跳跃，实现蹬墙跳，同一屏幕里的按钮才能被按下起反应，按钮可以从一个场景移动到另一个场景。
### 2022.3.12
优化了一些bug，改善玩家移动动画和按钮动画的交互，实现界面切换的动画效果。但仍有很多问题待解决。
### 2022.3.9
绘制了剩余按钮，对按钮做了简单的动画。布置了简单场景，摄像机实现跟随人物切换场景时移动。
### 2022.3.8
用简单模型长方形表示玩家，利用形状的变形、位移和旋转表示动画，绘制了几个基础按钮，并使用基础代码实现了玩家的移动和跳跃。